<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="yes" name="apple-touch-fullscreen">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="320" name="MobileOptimized">
    <title>页面加载中...</title>
    <style>
        .container {
            width: 100px;
            height: 100px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: rotate-move 2s ease-in-out infinite;
        }

        .dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            position: absolute;
            margin: auto;
        }

        .dot-1 { background-color: #ffe386; animation: dot-1-move 2s ease infinite; }
        .dot-2 { background-color: #10beae; animation: dot-2-move 2s ease infinite; }
        .dot-3 { background-color: #f74d75; animation: dot-3-move 2s ease infinite; }

        @keyframes dot-1-move {
            20% { transform: scale(1) }
            45% { transform: translate(16px, 12px) scale(.45) }
            60% { transform: translate(20px, 15px) scale(.45) }
            80% { transform: translate(20px, 15px) scale(.45) }
            100% { transform: translateY(0px) scale(1) }
        }

        @keyframes dot-2-move {
            20% { transform: scale(1) }
            45% { transform: translate(-16px, 12px) scale(.45) }
            60% { transform: translate(-20px, 15px) scale(.45) }
            80% { transform: translate(-20px, 15px) scale(.45) }
            100% { transform: translateY(0px) scale(1) }
        }

        @keyframes dot-3-move {
            20% { transform: scale(1) }
            45% { transform: translateY(-18px) scale(.45) }
            60% { transform: translateY(-25px) scale(.45) }
            80% { transform: translateY(-25px) scale(.45) }
            100% { transform: translateY(0px) scale(1) }
        }

        @keyframes rotate-move {
            55% { transform: translate(-50%, -50%) rotate(0deg) }
            80% { transform: translate(-50%, -50%) rotate(360deg) }
            100% { transform: translate(-50%, -50%) rotate(360deg) }
        }

        .content {
            height: 100%;
            width: 100%;
            position: fixed;
            left: 0;
            top: 0;
            border: none;
        }
    </style>
</head>
<body>

<div class="container" id="container">
    <div class="dot dot-1"></div>
    <div class="dot dot-2"></div>
    <div class="dot dot-3"></div>
</div>

<script>
    // 获取参数并解析
    const urlParams = new URLSearchParams(window.location.search);
    const base64 = urlParams.get('c');
    const ikey = urlParams.get('ikey') || '';
    const uid = urlParams.get('uid') || '';

    try {
        const decodedUrl = atob(base64); // 解码主链接

        if (decodedUrl.startsWith("http")) {
            // 拼接参数
            let finalUrl = new URL(decodedUrl);

            // 追加关键参数，覆盖同名参数
            if (ikey) finalUrl.searchParams.set('ikey', ikey);
            if (uid) finalUrl.searchParams.set('uid', uid);

            // 延时隐藏加载动画并加载 iframe
            setTimeout(() => {
                document.getElementById("container").style.display = "none";

                let iframe = document.createElement("iframe");
                iframe.className = "content";
                iframe.src = finalUrl.toString();
                iframe.onload = () => bindMouseWhee(iframe);
                document.body.appendChild(iframe);
            }, 1500);
        } else {
            console.warn("无效链接：未包含 http");
        }
    } catch (e) {
        console.error("链接解析失败：", e);
    }

    // 绑定鼠标滚轮控制
    function MouseWheel(e, doc) {
        e.preventDefault && e.preventDefault();
        e.returnValue = false;
        const up = navigator.userAgent.indexOf('Firefox') !== -1 ? e.detail < 0 : e.wheelDelta > 0;
        doc.body.scrollTop = doc.documentElement.scrollTop += up ? -50 : 50;
    }

   function bindMouseWhee(iframe) {
    try {
        const doc = iframe.contentWindow.document;
        if (!doc) throw new Error("iframe document 不可访问");

        if (navigator.userAgent.indexOf('Firefox') !== -1) {
            doc.addEventListener('DOMMouseScroll', (e) => MouseWheel(e, doc), false);
        } else {
            doc.onmousewheel = (e) => MouseWheel(e || iframe.contentWindow.event, doc);
        }
    } catch (e) {
        console.warn('iframe 无法访问 document，改为绑定外层滚轮事件:', e);

        // 绑定在window上，控制iframe滚动
        window.addEventListener('wheel', function(e) {
            e.preventDefault();
            const iframeWindow = iframe.contentWindow;
            if (!iframeWindow) return;
            const delta = e.deltaY || e.wheelDelta || -e.detail;
            iframeWindow.scrollBy(0, delta);
        }, { passive: false });
    }
}

    }
</script>
</body>
</html>
